<!DOCTYPE html>
<html>
<head>
    <title>Advanced Fractal Generator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            background: rgba(45, 45, 45, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #4CAF50;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
            margin-bottom: 30px;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        .control-group {
            background: rgba(61, 61, 61, 0.5);
            padding: 15px;
            border-radius: 8px;
            transition: transform 0.2s;
        }

        .control-group:hover {
            transform: translateY(-2px);
        }

        select, input, button {
            background: #3d3d3d;
            color: #fff;
            border: 1px solid #555;
            padding: 10px 15px;
            border-radius: 8px;
            width: 100%;
            margin: 5px 0;
            transition: all 0.3s;
        }

        select:hover, input:hover {
            background: #4d4d4d;
            border-color: #666;
        }

        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        button:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        #saveBtn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        #saveBtn:hover {
            background: linear-gradient(45deg, #1976D2, #2196F3);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }

        canvas {
            border: 3px solid #555;
            border-radius: 10px;
            max-width: 100%;
            height: auto;
            background: #000;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            transition: transform 0.3s;
        }

        canvas:hover {
            transform: scale(1.01);
        }

        .label {
            font-size: 14px;
            margin-bottom: 8px;
            color: #ddd;
            font-weight: bold;
        }

        .progress-container {
            width: 100%;
            margin: 20px 0;
        }

        .progress {
            width: 100%;
            height: 20px;
            background: #3d3d3d;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            transition: width 0.3s;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0.2) 50%,
                rgba(255,255,255,0) 100%
            );
            animation: shimmer 1.5s infinite;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .preset-btn {
            flex: 1;
            min-width: 120px;
            padding: 8px;
            background: linear-gradient(45deg, #666, #444);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .preset-btn:hover {
            background: linear-gradient(45deg, #777, #555);
            transform: translateY(-2px);
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Advanced Fractal Generator</h1>
        <div class="preset-buttons">
            <button class="preset-btn" data-preset="cosmic">Cosmic Spiral</button>
            <button class="preset-btn" data-preset="deep-ocean">Deep Ocean</button>
            <button class="preset-btn" data-preset="fire-phoenix">Fire Phoenix</button>
            <button class="preset-btn" data-preset="forest-dream">Forest Dream</button>
        </div>
        <div class="controls">
            <div class="control-group">
                <div class="label">Fractal Type:</div>
                <select id="fractalType">
                    <option value="mandelbrot">Mandelbrot Set</option>
                    <option value="julia">Julia Set</option>
                    <option value="burningShip">Burning Ship</option>
                    <option value="multibrot">Multibrot</option>
                    <option value="tricorn">Tricorn</option>
                    <option value="magnet">Magnet Set</option>
                </select>
            </div>
            <div class="control-group">
                <div class="label">Color Scheme:</div>
                <select id="colorScheme">
                    <option value="rainbow">Rainbow</option>
                    <option value="blue">Blue</option>
                    <option value="greyscale">Greyscale</option>
                    <option value="sunset">Sunset</option>
                    <option value="ocean">Ocean</option>
                    <option value="forest">Forest</option>
                    <option value="fire">Fire</option>
                    <option value="earth">Earth</option>
                    <option value="pastel">Pastel</option>
                    <option value="electric">Electric</option>
                    <option value="neon">Neon</option>
                    <option value="cosmic">Cosmic</option>
                </select>
            </div>
            <div class="control-group">
                <div class="label">Max Iterations:</div>
                <input type="number" id="maxIterations" value="100" min="1" max="2000">
            </div>
            <div class="control-group">
                <div class="label">Zoom:</div>
                <input type="range" id="zoom" value="1" min="0.1" max="10" step="0.1">
                <span id="zoomValue">1.0x</span>
            </div>
            <div class="control-group">
                <div class="label">Julia Constant:</div>
                <input type="number" id="juliaReal" value="-0.4" step="0.1" placeholder="Real">
                <input type="number" id="juliaImag" value="0.6" step="0.1" placeholder="Imaginary">
            </div>
        </div>
        <div class="button-group">
            <button id="generateBtn">Generate Fractal</button>
            <button id="saveBtn">Save Image</button>
            <button id="randomBtn">Random Settings</button>
            <button id="resetBtn">Reset View</button>
        </div>
        <div class="progress-container">
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
        <canvas id="fractalCanvas" width="800" height="600"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('fractalCanvas');
        const ctx = canvas.getContext('2d');
        const progressBar = document.getElementById('progressBar');
        let isDragging = false;
        let lastX = 0;
        let lastY = 0;
        let offsetX = 0;
        let offsetY = 0;

        // Enhanced color schemes
        const colorSchemes = {
            rainbow: (t) => `hsl(${t * 360}, 100%, 50%)`,
            blue: (t) => `rgb(0, ${Math.floor(t * 100)}, ${Math.floor(t * 255)})`,
            greyscale: (t) => {
                const v = Math.floor(t * 255);
                return `rgb(${v}, ${v}, ${v})`;
            },
            sunset: (t) => {
                const r = Math.floor(255 * Math.pow(t, 0.8));
                const g = Math.floor(100 * Math.pow(t, 1.2));
                const b = Math.floor(50 + 100 * Math.pow(t, 1.5));
                return `rgb(${r}, ${g}, ${b})`;
            },
            ocean: (t) => {
                const r = Math.floor(50 * Math.sin(t * Math.PI));
                const g = Math.floor(100 + 155 * Math.pow(t, 0.9));
                const b = Math.floor(150 + 105 * Math.pow(t, 0.7));
                return `rgb(${r}, ${g}, ${b})`;
            },
            forest: (t) => {
                const r = Math.floor(50 * Math.pow(t, 1.2));
                const g = Math.floor(100 + 155 * Math.pow(t, 0.8));
                const b = Math.floor(50 * Math.pow(t, 1.5));
                return `rgb(${r}, ${g}, ${b})`;
            },
            fire: (t) => {
                const r = Math.floor(200 + 55 * Math.pow(t, 0.5));
                const g = Math.floor(100 * Math.pow(t, 1.5));
                const b = Math.floor(50 * Math.pow(t, 2));
                return `rgb(${r}, ${g}, ${b})`;
            },
            earth: (t) => {
                const r = Math.floor(139 * Math.pow(t, 0.9));
                const g = Math.floor(69 * Math.pow(t, 1.1));
                const b = Math.floor(19 * Math.pow(t, 1.3));
                return `rgb(${r}, ${g}, ${b})`;
            },
            pastel: (t) => `hsl(${t * 360}, 70%, ${80 + t * 20}%)`,
            electric: (t) => {
                const r = Math.floor(200 * Math.sin(t * Math.PI * 2));
                const g = Math.floor(200 + 55 * Math.sin(t * Math.PI * 3));
                const b = Math.floor(255 * Math.cos(t * Math.PI * 4));
                return `rgb(${r}, ${g}, ${b})`;
            },
            neon: (t) => {
                const h = t * 360;
                const s = 100;
                const l = 50 + 25 * Math.sin(t * Math.PI * 2);
                return `hsl(${h}, ${s}%, ${l}%)`;
            },
            cosmic: (t) => {
                const h = 270 + t * 90;
                const s = 80 + 20 * Math.sin(t * Math.PI * 4);
                const l = 30 + 40 * Math.pow(t, 0.5);
                return `hsl(${h}, ${s}%, ${l}%)`;
            }
        };

        // Enhanced fractal functions
        function mandelbrot(x0, y0, maxIter) {
            let x = 0, y = 0;
            let iter = 0;
            while (x * x + y * y < 4 && iter < maxIter) {
                const xtemp = x * x - y * y + x0;
                y = 2 * x * y + y0;
                x = xtemp;
                iter++;
            }
            return iter;
        }

        function julia(x0, y0, maxIter) {
            let x = x0, y = y0;
            const cx = parseFloat(document.getElementById('juliaReal').value);
            const cy = parseFloat(document.getElementById('juliaImag').value);
            let iter = 0;
            while (x * x + y * y < 4 && iter < maxIter) {
                const xtemp = x * x - y * y + cx;
                y = 2 * x * y + cy;
                x = xtemp;
                iter++;
            }
            return iter;
        }

        function burningShip(x0, y0, maxIter) {
            let x = 0, y = 0;
            let iter = 0;
            while (x * x + y * y < 4 && iter < maxIter) {
                const xtemp = x * x - y * y + x0;
                y = Math.abs(2 * x * y) + y0;
                x = xtemp;
                iter++;
            }
            return iter;
        }

        function multibrot(x0, y0, maxIter) {
            let x = 0, y = 0;
            let iter = 0;
            const power = 3;
            while (x * x +y * y < 4 && iter < maxIter) {
                const r = Math.sqrt(x * x + y * y);
                const theta = Math.atan2(y, x);
                const xtemp = Math.pow(r, power) * Math.cos(power * theta) + x0;
                y = Math.pow(r, power) * Math.sin(power * theta) + y0;
                x = xtemp;
                iter++;
            }
            return iter;
        }

        function tricorn(x0, y0, maxIter) {
            let x = 0, y = 0;
            let iter = 0;
            while (x * x + y * y < 4 && iter < maxIter) {
                const xtemp = x * x - y * y + x0;
                y = -2 * x * y + y0;
                x = xtemp;
                iter++;
            }
            return iter;
        }

        function magnet(x0, y0, maxIter) {
            let x = x0, y = y0;
            let iter = 0;
            while (x * x + y * y < 4 && iter < maxIter) {
                const xtemp = ((x * x - y * y + 1) * x) / (x * x + y * y);
                y = (2 * x * y * y) / (x * x + y * y);
                x = xtemp;
                iter++;
            }
            return iter;
        }

        // Presets configurations
        const presets = {
            cosmic: {
                fractalType: 'mandelbrot',
                colorScheme: 'cosmic',
                maxIterations: 500,
                zoom: 1.5,
                juliaReal: -0.4,
                juliaImag: 0.6
            },
            'deep-ocean': {
                fractalType: 'julia',
                colorScheme: 'ocean',
                maxIterations: 300,
                zoom: 2,
                juliaReal: -0.8,
                juliaImag: 0.156
            },
            'fire-phoenix': {
                fractalType: 'burningShip',
                colorScheme: 'fire',
                maxIterations: 400,
                zoom: 1.2,
                juliaReal: -0.4,
                juliaImag: 0.6
            },
            'forest-dream': {
                fractalType: 'multibrot',
                colorScheme: 'forest',
                maxIterations: 200,
                zoom: 1.8,
                juliaReal: -0.4,
                juliaImag: 0.6
            }
        };

        // Drawing function
        function drawFractal() {
            const maxIter = parseInt(document.getElementById('maxIterations').value);
            const fractalType = document.getElementById('fractalType').value;
            const colorScheme = document.getElementById('colorScheme').value;
            const zoom = parseFloat(document.getElementById('zoom').value);

            const imageData = ctx.createImageData(canvas.width, canvas.height);
            const data = imageData.data;

            let fractalFunc;
            switch(fractalType) {
                case 'mandelbrot':
                    fractalFunc = mandelbrot;
                    break;
                case 'julia':
                    fractalFunc = julia;
                    break;
                case 'burningShip':
                    fractalFunc = burningShip;
                    break;
                case 'multibrot':
                    fractalFunc = multibrot;
                    break;
                case 'tricorn':
                    fractalFunc = tricorn;
                    break;
                case 'magnet':
                    fractalFunc = magnet;
                    break;
                default:
                    fractalFunc = mandelbrot;
            }

            const colorFunc = colorSchemes[colorScheme];
            const startTime = performance.now();

            for (let y = 0; y < canvas.height; y++) {
                const progress = (y / canvas.height) * 100;
                progressBar.style.width = `${progress}%`;

                for (let x = 0; x < canvas.width; x++) {
                    const x0 = (x - canvas.width/2) / (zoom * canvas.width/4) + offsetX;
                    const y0 = (y - canvas.height/2) / (zoom * canvas.height/4) + offsetY;

                    const iter = fractalFunc(x0, y0, maxIter);
                    const t = iter === maxIter ? 0 : iter / maxIter;

                    const color = colorFunc(t);
                    const match = color.match(/\d+/g).map(Number);
                    
                    const pixelIndex = (y * canvas.width + x) * 4;
                    data[pixelIndex] = match[0];     // R
                    data[pixelIndex + 1] = match[1]; // G
                    data[pixelIndex + 2] = match[2]; // B
                    data[pixelIndex + 3] = 255;      // A
                }
            }

            ctx.putImageData(imageData, 0, 0);
            progressBar.style.width = '100%';

            const endTime = performance.now();
            console.log(`Render time: ${(endTime - startTime).toFixed(2)}ms`);
        }

        // Event Listeners
        document.getElementById('generateBtn').addEventListener('click', drawFractal);

        document.getElementById('saveBtn').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'fractal.png';
            link.href = canvas.toDataURL();
            link.click();
        });

        document.getElementById('randomBtn').addEventListener('click', () => {
            document.getElementById('fractalType').value = ['mandelbrot', 'julia', 'burningShip', 'multibrot', 'tricorn', 'magnet'][Math.floor(Math.random() * 6)];
            document.getElementById('colorScheme').value = Object.keys(colorSchemes)[Math.floor(Math.random() * Object.keys(colorSchemes).length)];
            document.getElementById('maxIterations').value = Math.floor(Math.random() * 500) + 100;
            document.getElementById('zoom').value = Math.random() * 3 + 0.5;
            document.getElementById('zoomValue').textContent = `${parseFloat(document.getElementById('zoom').value).toFixed(1)}x`;
            drawFractal();
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            offsetX = 0;
            offsetY = 0;
            document.getElementById('zoom').value = 1;
            document.getElementById('zoomValue').textContent = '1.0x';
            drawFractal();
        });

        // Zoom slider update
        document.getElementById('zoom').addEventListener('input', (e) => {
            document.getElementById('zoomValue').textContent = `${parseFloat(e.target.value).toFixed(1)}x`;
            drawFractal();
        });

        // Preset buttons
        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const preset = presets[btn.dataset.preset];
                document.getElementById('fractalType').value = preset.fractalType;
                document.getElementById('colorScheme').value = preset.colorScheme;
                document.getElementById('maxIterations').value = preset.maxIterations;
                document.getElementById('zoom').value = preset.zoom;
                document.getElementById('zoomValue').textContent = `${preset.zoom.toFixed(1)}x`;
                document.getElementById('juliaReal').value = preset.juliaReal;
                document.getElementById('juliaImag').value = preset.juliaImag;
                drawFractal();
            });
        });

        // Pan and zoom with mouse
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const dx = (e.clientX - lastX) / (canvas.width * parseFloat(document.getElementById('zoom').value));
                const dy = (e.clientY - lastY) / (canvas.height * parseFloat(document.getElementById('zoom').value));
                offsetX -= dx * 4;
                offsetY -= dy * 4;
                lastX = e.clientX;
                lastY = e.clientY;
                drawFractal();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isDragging = false;
        });

        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const zoom = parseFloat(document.getElementById('zoom').value);
            const newZoom = zoom * (e.deltaY > 0 ? 0.9 : 1.1);
            document.getElementById('zoom').value = Math.min(Math.max(newZoom, 0.1), 10);
            document.getElementById('zoomValue').textContent = `${parseFloat(document.getElementById('zoom').value).toFixed(1)}x`;
            drawFractal();
        });

        // Initial draw
        drawFractal();
    </script>
</body>
</html>
